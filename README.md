istanbul-cobertura-badger
=========================
[![Travis](https://travis-ci.org/marcellodesales/istanbul-cobertura-badger.svg)](https://travis-ci.org/marcellodesales/istanbul-cobertura-badger) [![Code Climate](https://codeclimate.com/github/marcellodesales/istanbul-cobertura-badger/badges/gpa.svg)](https://codeclimate.com/github/marcellodesales/istanbul-cobertura-badger) [![Code Climate](https://david-dm.org/marcellodesales/istanbul-cobertura-badger.png)](https://david-dm.org/marcellodesales/istanbul-cobertura-badger)

Create a [coverage | 100%] badge by reading the Cobertura coverage report from node-istanbul based on https://github.com/badges/shields.

[![NPM](https://nodei.co/npm/istanbul-cobertura-badger.png?downloads=true&downloadRank=true&stars=true)](https://nodei.co/npm/istanbul-cobertura-badger/)

Requirements
========

I started to work with Node a few months ago, and I recently stumble upon many different badges on GitHub pages,
including code coverage. I posted a question on Stackoverflow about it:

http://stackoverflow.com/questions/26028024/how-to-make-a-gulp-code-coverage-badge

* I want to be able to generate the coverage report after code coverage runs by any Node.js build system like
Gulp or Grunt, and be able to publish the badge on the README.md file through a Jenkins link;
* The badge displays appropriate colors for the badge.
 * Green: >= 80% overall coverage ![](http://img.shields.io/badge/coverage-93%-brightgreen.svg)
 * Yellow: 65% <= overall coverage < 80% ![](http://img.shields.io/badge/coverage-74%-yellow.svg)
 * Red: < 65% overall coverage ![](http://img.shields.io/badge/coverage-32%-red.svg)

The idea is to serve in the Node.js README for internal use in a GitHub enterprise machine along with
Jenkins.

Installation
=========

```
npm install --save-dev istanbul-cobertura-badger
```

Use
=========

The following parameters are used:

* Cobertura file report: The XML-based cobertura file generated by Istanbul "cobertura" report.
* Destination Path: The path to the destination directory where the badge image will be created.
* Callback: The callback function after the file has been downloaded.

Upon calling the callback function, the file `cobertura.svg` will be available in the destination path.

Examples
========

```
var coberturaBadger = require('istanbul-cobertura-badger');

var coberturaFile = "build/tests/cobertura-coverage.xml";
var destinationPath = path.join(process.env.PWD, "build/tests");

coverageBadger(coberturaFile, destinationPath, function() {
  console.log("Badge created at " + destinationPath + "/cobertura.svg");
});
```

Gulp Build
=========

```
gulp.task('test', function() {
  gulp.src('src/**/*.js')
    .pipe(istanbul()) // coverying files
    .on('finish', function () {
      gulp.src(['test/*.js'])
        .pipe(mocha({reporter: 'spec'})) // different reporters at http://visionmedia.github.io/mocha/#reporters
        .pipe(istanbul.writeReports({
          reporters: ['cobertura', 'text-summary', 'html'], // https://www.npmjs.org/package/gulp-istanbul#reporters
          reportOpts: { dir: './docs/tests' }
        }))
        .on('end', function() {

           coverageBadger("docs/tests/cobertura-coverage.xml", path.join(process.env.PWD, "docs/tests"), function() {
             process.exit();
           });

        });
    });
});
```
